document.addEventListener('DOMContentLoaded', function() {
    const imageUpload = document.getElementById('image-upload');
    const audioUpload = document.getElementById('audio-upload');
    const generateBtn = document.getElementById('generate-btn');
    const statusMessage = document.getElementById('status-message');
    const videoOutputContainer = document.getElementById('video-output-container');
    
    let uploadedImage = null;
    let uploadedAudio = null;

    imageUpload.addEventListener('change', (event) => {
        uploadedImage = event.target.files[0];
        if (uploadedImage) {
            document.getElementById('image-info').textContent = uploadedImage.name;
        }
    });

    audioUpload.addEventListener('change', (event) => {
        uploadedAudio = event.target.files[0];
        if (uploadedAudio) {
            document.getElementById('audio-info').textContent = uploadedAudio.name;
        }
    });

    generateBtn.addEventListener('click', async () => {
        if (!uploadedImage || !uploadedAudio) {
            alert('অনুগ্রহ করে একটি ছবি এবং একটি অডিও ফাইল আপলোড করুন।');
            return;
        }

        statusMessage.textContent = 'ভিডিও তৈরি হচ্ছে... একটু অপেক্ষা করুন।';
        generateBtn.disabled = true;

        const formData = new FormData();
        formData.append('image', uploadedImage);
        formData.append('audio', uploadedAudio);

        try {
            const response = await fetch('/generate_video', {
                method: 'POST',
                body: formData
            });

            if (response.ok) {
                const blob = await response.blob();
                const url = URL.createObjectURL(blob);
                
                videoOutputContainer.innerHTML = `
                    <video controls src="${url}"></video>
                    <a href="${url}" download="generated_video.mp4">ডাউনলোড করুন</a>
                `;
                statusMessage.textContent = 'ভিডিও তৈরি হয়ে গেছে!';
            } else {
                statusMessage.textContent = 'ভিডিও তৈরি করতে সমস্যা হয়েছে।';
                console.error('Server responded with an error:', response.statusText);
            }
        } catch (error) {
            statusMessage.textContent = 'সার্ভারের সাথে সংযোগে সমস্যা হয়েছে।';
            console.error('Error generating video:', error);
        } finally {
            generateBtn.disabled = false;
        }
    });
});